{% extends "base.html" %}

{% block title %}Collections{% endblock %}

{% block extra_css %}
<style>
  html, body {
    height: 100%;
    background: linear-gradient(to bottom right, #ffffff, #f8f9fa);
    overflow-x: hidden;
  }

  .page-content {
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .scroll-container {
    flex-grow: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 20px;
    background: #ffffff;
    border: 2px solid #42EAFF;
    border-radius: 10px;
    margin-top: 20px;
  }

  .scroll-container::-webkit-scrollbar {
    width: 6px;
  }
  .scroll-container::-webkit-scrollbar-thumb {
    background-color: #4272FF;
    border-radius: 10px;
  }
  .scroll-container::-webkit-scrollbar-track {
    background: #e0e0e0;
  }

  h2 {
    color: #4272FF;
    font-weight: bold;
  }

  .btn-primary {
    background-color: #42EAFF;
    border-color: #42EAFF;
    color: black;
    font-weight: bold;
  }
  .btn-primary:hover {
    background-color: #4272FF;
    border-color: #4272FF;
    color: white;
  }
</style>
{% endblock %}

{% block content %}
<div class="page-content">
  
  <!-- Top Bar -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Collections</h2>
    <p class="mb-0">Logged in as {{ user.username }}</p>
  </div>

  <!-- Add Collection Button -->
  <div class="mb-4">
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCollectionModal">
      ‚ûï Add New Collection
    </button>
  </div>

  <!-- Modal for Adding Collection -->
  <div class="modal fade" id="addCollectionModal" tabindex="-1" aria-labelledby="addCollectionLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form method="post" action="{% url 'collections' %}">
          {% csrf_token %}
          <div class="modal-header">
            <h5 class="modal-title" id="addCollectionLabel">Create New Collection</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Collection Title</label>
              <input type="text" class="form-control" name="name" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" name="description" rows="3"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Select Items</label>
              <select class="form-select" name="items" multiple>
                {% for item in items %}
                  <option value="{{ item.id }}">{{ item.title }}</option>
                {% endfor %}
              </select>
              <small class="form-text text-muted">Hold Ctrl (Windows) or Command (Mac) to select multiple items.</small>
            </div>
            <div class="mb-3">
              <label class="form-label">Visibility</label>
              <select class="form-select" name="visibility">
                {% if user.profile.userRole == 0 %}
                  <option value="public" selected>Public</option>
                {% else %}
                  <option value="public" selected>Public</option>
                  <option value="private">Private</option>
                {% endif %}
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Save Collection</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Your Collections -->
  <h3 class="mt-5">Your Collections</h3>
  <div class="scroll-container">
    {% if user_collections %}
      <div class="row">
        {% for c in user_collections %}
          <div class="col-12 mb-3">
            <div class="card">
              <div class="card-body position-relative">
                <h5 class="card-title">{{ c.name }}</h5>
                <p class="card-text">{{ c.description }}</p>
                <a href="{% url 'collection_detail' c.id %}" class="stretched-link"></a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="alert alert-warning" role="alert">
        üì≠ You have no collections yet.
      </div>
    {% endif %}
  </div>

  <!-- Public Collections -->
  <h3 class="mt-5">Collections by Others</h3>
  <div class="scroll-container">
    {% if collections %}
      <div class="row">
        {% for c in collections %}
          {% if c.creator != user.profile %}
            <div class="col-12 mb-3">
              <div class="card">
                <div class="card-body position-relative">
                  <h5 class="card-title">{{ c.name }}</h5>
                  <p class="card-text">{{ c.description }}</p>
                  <small class="text-muted">Created by: {{ c.creator.user.username }}</small>
                  <a href="{% url 'collection_detail' c.id %}" class="stretched-link"></a>
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% else %}
      <div class="alert alert-warning" role="alert">
        No public collections found.
      </div>
    {% endif %}
  </div>

  <!-- Back to Homepage -->
  <div class="mt-4">
    <a href="{% url 'home_page_router' %}" class="btn btn-primary">‚¨ÖÔ∏è Back to Homepage</a>
  </div>

</div>

{% endblock %}
