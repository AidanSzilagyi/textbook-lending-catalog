<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ class_obj.name }} - Class Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .unlink-btn {
      color: red;
      font-weight: bold;
      cursor: pointer;
      margin-left: 10px;
    }
  </style>
</head>
<body class="container mt-5">
  <header class="fixed-top bg-light text-center py-3">
    <h1>{{ class_obj.name }}</h1>
  </header>
  <main class="mt-5 pt-5">
    <section class="mb-4">
      <h3>Description</h3>
      <p>{{ class_obj.description }}</p>
    </section>
    <section>
      <h3>Required Items</h3>
      {% if required_items %}
      <div class="list-group">
        {% for item in required_items %}
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-1">{{ item.identifier }}</h5>
              <p class="mb-1">
                <small>
                  Tags:
                  {% for tag in item.tags.all %}
                    {{ tag.name }}{% if not forloop.last %}, {% endif %}
                  {% endfor %}
                </small>
              </p>
              {% if item.is_available %}
                <span class="badge bg-success">Available</span>
              {% else %}
                <span class="badge bg-danger">Not Available</span>
              {% endif %}
            </div>
            {% if user.profile.userRole == 1 %}
              <!-- Unlink button for librarians -->
              <a href="{% url 'unlink_material' class_obj.slug item.id %}" class="unlink-btn" title="Remove material from this class">X</a>
            {% endif %}
          </div>
        {% endfor %}
      </div>
      {% else %}
        <p>No required items for this class.</p>
      {% endif %}
    </section>
  </main>
  <footer class="mt-4">
    <a href="{% url 'home_page_router' %}" class="btn btn-primary">Back to Homepage</a>
    {% if user.profile.userRole == 1 %}
      <!-- Button to toggle the material creation form -->
      <button id="addMaterialBtn" class="btn btn-success ms-2">Add Material</button>
    {% endif %}
  </footer>
  
  {% if user.profile.userRole == 1 %}
    <!-- Hidden form for creating a new Item -->
    <div id="materialForm" class="card p-4 mt-3" style="display: none;">
      <form method="POST" action="{% url 'material_create' class_obj.slug %}">
        {% csrf_token %}
        <div class="mb-3">
          <label for="identifier" class="form-label">Identifier</label>
          <input type="text" name="identifier" id="identifier" class="form-control" required>
        </div>
        <div class="mb-3 form-check">
          <input type="checkbox" name="is_available" id="is_available" class="form-check-input">
          <label class="form-check-label" for="is_available">Available</label>
        </div>
        <div class="mb-3">
          <label for="tags" class="form-label">Tags</label>
          <select name="tags" id="tags" class="form-select" multiple>
            {% for tag in tags %}
              <option value="{{ tag.id }}">{{ tag.name }}</option>
            {% endfor %}
          </select>
          <small class="form-text text-muted">
            Hold down Ctrl (Windows) or Command (Mac) to select multiple options.
          </small>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
        <button type="button" id="cancelMaterialBtn" class="btn btn-secondary ms-2">Cancel</button>
      </form>
    </div>
  {% endif %}
  
  <script>
    document.addEventListener("DOMContentLoaded", function(){
      const addMaterialBtn = document.getElementById("addMaterialBtn");
      const cancelMaterialBtn = document.getElementById("cancelMaterialBtn");
      const materialForm = document.getElementById("materialForm");

      if(addMaterialBtn){
        addMaterialBtn.addEventListener("click", function(){
          materialForm.style.display = "block";
        });
      }
      if(cancelMaterialBtn){
        cancelMaterialBtn.addEventListener("click", function(){
          materialForm.style.display = "none";
        });
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
